## C多线程编程 (1)

### 绪论
随着CPU计算核心数量的增加, 并发编程成为了有效发挥硬件性能的编程模型.C/C++ 11都从语言层面上增加了对多线程的支持. 但并发程序本身模型复杂, 对技术有要求. 这个系列记录下自己的学习过程.

### 体系架构 SMP/NUMA/MPP
从计算机系统架构来看, 目前的商用服务器可以分为三类, 即对称多处理器(SMP: Symmetric Multi-Processor), 非一致存储访问(NUMA:Non-Uniform Memory Access)以及大规模并行处理(MPP: Massive Parallel Processing).

#### SMP
我们常用的PC机, 笔记本都是这种结构, 简单的说, 就是这种系统有多个CPU, 所有的CPU共享所有的资源, 包括总线, 内存, IO存储等, 整个系统只有一个操作系统. CPU之间没有差别, 平等的访问所有的内存以及外部设备. 操作系统维护着一个队列, 每个处理器依次处理队列中的进程. 多个独立的处理器, 当然会出现争用用一个设备或者资源的时候, 这个时候就需要使用硬件或者软件的锁机制来协调. 

由于各CPU核心访问共享内存的地址速度都是一样的, SMP也被称为一致存储器访问(UMA). 共享所有资源模型简单, 但也带来了扩展的困难, 因为任何一个共享的资源, 都可能成为扩展的瓶颈. 为此, 人们发明了NUMA的结构.

#### NUMA

NUMA架构的服务器, 有多个CPU模块组成, 每个CPU模块, 都有自己的本地内存, IO插槽. 节点之间, 通过互联模块连接和信息交换. 注意的是, 每个CPU都可以访问整个系统的内存, [访问本地内存比访问远程内存快50%](http://queue.acm.org/detail.cfm?id=2513149).

#### MPP

MPP可以看做多个SMP通过网络连接构成的集群系统. 每个SMP节点有自己的操作系统和内存, 这个集群通过RPC进行协调计算. 很显然, 这种结构更适合CPU-Bound类型的任务.


### 多线程程序

下面, 我们主要关注SMP架构下, 并行程序的实现, 也就是POSIX Thread的实现.

### 什么是线程?

准确的讲, 线程是可以被操作系统独立调度的一个指令执行流. 粗略的讲, 假如两个函数同时独立的被操作系统调度执行, 这就是一个"并发"程序. (并发和并行其实还是有明显的区别的, 并行意味着, 同一时刻, 两个或多个线程的指令都在执行, 这就要求, 处理器必须是多核心或者多CPU的; 并发的概念更宽泛一些, 除了包含并行的情形外, 还可以指两个线程都处于被调度执行的状态, 比如只有一个CPU核心, 两个或多个线程轮流各执行一些指令, 有一句很好的话, 很好的帮助理解并行和并发: Concurrency is about dealing with lots of things at once. Parallelism is about doing lots of things at once.).

### 进程

在深入了解线程之前, 我们先搞清楚Unix进程的概念. 



